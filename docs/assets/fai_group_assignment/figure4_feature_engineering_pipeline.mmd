flowchart LR
  %% Figure 4: Feature engineering pipeline

  subgraph Sources["Data Sources"]
    APP["Appearances / Minutes<br/>(All Competitions)"]
    INJ["Injury Records<br/>(Start, End, Duration)"]
    PROF["Player Profiles<br/>(DOB, Position)"]
  end

  subgraph Temporal["Temporal Processing"]
    WEEK["Week Alignment<br/>(Monday start)"]
    ROLL["Rolling Window<br/>Aggregation"]
    PRIOR["Strictly Prior<br/>Filtering"]
  end

  subgraph Features["Feature Groups"]
    W["Workload<br/>minutes_last_4w, ACWR"]
    R["Rest<br/>days_since_last_played"]
    H["History<br/>injuries_last_365d, recency"]
    D["Demographics<br/>age, position"]
  end

  APP --> WEEK
  INJ --> WEEK
  WEEK --> PRIOR

  APP --> ROLL --> PRIOR --> W
  PRIOR --> R
  PRIOR --> H
  PROF --> D

  W & R & H & D --> PANEL["Feature Matrix"]
